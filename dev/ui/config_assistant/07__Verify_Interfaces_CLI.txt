*** Settings ***
Documentation     DVT Test resource for Robot Framework
Library           String
Library           Telnet
Library           Collections
Library           PyroLibrary

*** Variables ***
${LAN_IP}               10.10.9.164
${TELNET_USER_NAME}        admin
${TELNET_PASSWORD}         password
${ENABLE_PASSWORD}         password
${TELNET_LOGIN_PROMPT}     Username:
${TELNET_PASSWORD_PROMPT}  Password:
#${COMMAND_FAIL_REGEX}      (?m)(%\ Unrecognized\ command)|(%\ Invalid\ or\ incomplete)|(%Input\ has\ invalid\ format)|(%-+)
${PROMPT}                  >
${SHOW_VOICE_USERS}        show voice users


*** Test Cases ***
Login via Telnet
    [Documentation]    This creates a telnet session, logs into the unit, and stores the unit's hostname in "${HOSTNAME}". \ This keyword leaves you at global enable mode on an AOS unit.
    ${telnet_id_temp}    Telnet.Open Connection    ${LAN_IP}    timeout=10 seconds
    Set Global Variable    ${TELNET_ID}    ${telnet_id_temp}
    Telnet.Login    ${TELNET_USER_NAME}    ${TELNET_PASSWORD}    ${TELNET_LOGIN_PROMPT}    ${TELNET_PASSWORD_PROMPT}
    Telnet.Set Prompt    ${PROMPT}
    Telnet.Write    ${EMPTY}
    ${out}=    Telnet.Read Until Prompt
    ${out}=    Replace String    ${out}    >    ${EMPTY}
    Set Global Variable    ${HOSTNAME}    ${out}
    Telnet.Write    enable
    Telnet.Read Until    Password:
    Telnet.Set Prompt    ${HOSTNAME}#    prompt_is_regexp=False
    Telnet.Write    ${ENABLE_PASSWORD}
    Telnet.Write    no events
    Telnet.Write    terminal length 0
    Telnet.Read Until Prompt
    Sleep    5

Check Interface Ethernet 0/1
    Telnet.Write    show interface gigabit-ethernet 0/1
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    giga-eth 0/1 is UP, line protocol is UP
	Should Contain    ${interface}    Internet address is ${WAN_PORT}, netmask is ${WAN_MASK}  (via DHCP)
	
Check Interface Ethernet 0/2
    Telnet.Write    show interface gigabit-ethernet 0/2
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    giga-eth 0/2 is UP, line protocol is UP
	Should Contain    ${interface}    Ip address is ${LAN_PORT}, netmask is ${LAN_MASK}

Check Interface FXO 0/1
    Telnet.Write    show interface fxo 0/1
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/1 is UP
	
Check Interface FXO 0/2
    Telnet.Write    show interface fxo 0/2
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/2 is UP
	
Check Interface FXO 0/3
    Telnet.Write    show interface fxo 0/3
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/3 is UP
	
Check Interface FXO 0/4
    Telnet.Write    show interface fxo 0/4
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/4 is UP
	
Check Interface FXO 0/5
    Telnet.Write    show interface fxo 0/5
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/5 is UP
	
Check Interface FXO 0/6
    Telnet.Write    show interface fxo 0/6
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxo 0/6 is UP
	
Check Interface FXS 0/1
    Telnet.Write    show interface fxs 0/1
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxs 0/1 is UP
	
Check Interface FXS 0/2
    Telnet.Write    show interface fxs 0/2
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    fxs 0/2 is UP
	
Check Interface PRI
    Telnet.Write    show interface pri 1
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    Switch protocol:  National ISDN 2
	Should Contain    ${interface}    Calling-party number:  2565552222
	Should Contain    ${interface}    Signaling role:  user (TE)
	
Check SLA Group
	Telnet.Write    show voice line-group GroupT07
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    Trunk: T07
	
Check Remote Phone Rule Set
	Telnet.Write    show running-config | begin hmr policy CA_FMFM_remote-phone-fix
    ${interface}=    Telnet.Read Until Prompt
	Should Contain    ${interface}    hmr policy CA_FMFM_remote-phone-fix
	Should Contain    ${interface}    rule-set CA_Remote_Phone_Tweaks 10
	Should Contain    ${interface}    rule-set CA_FMFM 20
	Should Contain    ${interface}    hmr rule-set CA_FMFM
	Should Contain    ${interface}    message-rule substitute_ani_T08 message-type request 80
	Should Contain    ${interface}    match header diversion match-value /FMFM8885999698/
	Should Contain    ${interface}    modify header diversion position first-match new-value /8885999698/ 20
	Should Contain    ${interface}    hmr rule-set CA_Remote_Phone_Tweaks
	Should Contain    ${interface}    message-rule CA_Change_Expires_Time message-type response 10
	Should Contain    ${interface}    match header CSeq match-value /REGISTER/i
	Should Contain    ${interface}    match header sip-status-line match-value /200/
	Should Contain    ${interface}    modify header Expires position first-match new-value /60/ 10
	